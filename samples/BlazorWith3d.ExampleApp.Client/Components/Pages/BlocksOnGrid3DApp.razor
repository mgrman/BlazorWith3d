@page "/app"
@using BlazorWith3d.ExampleApp.Client.Components
@using BlazorWith3d.ExampleApp.Client.Unity.Components
@using BlazorWith3d.ExampleApp.Client.HTML
@inject IFlagProvider  FlagProvider

<PageTitle>WebGL instance</PageTitle>

    @foreach (var renderer in _renderers)
    {
        <InputCheckbox @bind-Value="renderer.IsSelected" DisplayName="@renderer.Label"/>
        @renderer.Label
        <br/>
    }

    <BlocksOnGrid3DComponent>
        
        @foreach(var renderer in _renderers.Where(o=>o.IsSelected).Select(o=>o.Label))
        
        @switch (renderer)
        {
            case "Unity WebGPU":
                <BlocksOnGridUnityRenderer></BlocksOnGridUnityRenderer>
                // use binary api with response
                break;
            case "Unity WebGPU (JSON)":
                <BlocksOnGridUnityRenderer UseJsonSerializer="true"></BlocksOnGridUnityRenderer>
                // use binary api with response
                break;
            case "Html":
                <BlocksOnGridHTMLComponent></BlocksOnGridHTMLComponent>
                // implements the interface directly
                break;
            case "Babylon":
                <BlazorWith3d.ExampleApp.Client.Babylon.BlocksOnGridBabylonRenderer></BlazorWith3d.ExampleApp.Client.Babylon.BlocksOnGridBabylonRenderer>
                // uses binary TS interface with response
                break;
            case "ThreeJS":
                <BlazorWith3d.ExampleApp.Client.ThreeJS.BlocksOnGridThreeJSRenderer></BlazorWith3d.ExampleApp.Client.ThreeJS.BlocksOnGridThreeJSRenderer>
                // uses binary TS interface with response
                break;
            case "ThreeJS (no copy)":
                <BlazorWith3d.ExampleApp.Client.ThreeJS.BlocksOnGridThreeJSRenderer CopyArrays="false"></BlazorWith3d.ExampleApp.Client.ThreeJS.BlocksOnGridThreeJSRenderer>
                // uses binary TS interface with response
                break;
            case "ThreeJS.Interop":
                <BlazorWith3d.ExampleApp.Client.ThreeJS.BlocksOnGridThreeJSDirectRenderer></BlazorWith3d.ExampleApp.Client.ThreeJS.BlocksOnGridThreeJSDirectRenderer>
                // uses generated interop code 
                break;
            case "Unity Editor Debug Relay":
                <BlocksOnGridUnityDebugRelay ></BlocksOnGridUnityDebugRelay>
                // uses generated interop code 
                break;
            default:
                <text> Unsupported renderer type @renderer</text>
                break;
        }

    </BlocksOnGrid3DComponent>


@code{

    List<Selection> _renderers ;

    protected override void OnInitialized()
    {
        _renderers = new []{ "Unity WebGPU","Unity WebGPU (JSON)", "Html", "Babylon", "ThreeJS", "ThreeJS.Interop","ThreeJS (no copy)"}.Select(o=>new Selection(o)).ToList();
        if (FlagProvider.IsUnityRelayEnabled)
        {
            _renderers.Add(new Selection("Unity Editor Debug Relay"));
        }
        base.OnInitialized();
    }

    private class Selection
    {
        public Selection(string label)
        {
            Label = label;
            IsSelected = false;
        }

        public string Label { get; }
        
        public bool IsSelected { get; set; }
    }

}
