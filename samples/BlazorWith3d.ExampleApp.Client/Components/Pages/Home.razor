@page "/"
@inject IFlagProvider FlagProvider
@inject NavigationManager NavigationManager

<PageTitle>Home</PageTitle>

<h1>Hello, world!</h1>

Welcome to your BlazorWith3d app.


@if (FlagProvider.IsWindowsBuildLinkEnabled)
{
    <br/>
    <a href="/windowsApp.zip"> Download Windows MAUI build</a>
}

@if (FlagProvider.SupportedRenderModes.Length > 1)
{
    <br/>
    @if (!RendererInfo.IsInteractive)
    {
        <text> Loading ...</text>
    }
    else
    {
        <InputSelect @bind-Value="_renderModeName" class="form-select">
            @foreach (var renderMode in FlagProvider.SupportedRenderModes)
            {
                <option value="@renderMode.GetType().Name">@(renderMode.GetType().Name)</option>
            }
        </InputSelect>
    }
}


@code {
    string? _renderModeName
    {
        get
        {
            return  _renderMode?.GetType().Name ?? "";
        }

        set
        {
            _renderMode = FlagProvider.SupportedRenderModes.FirstOrDefault(o => o.GetType().Name == value);
            FlagProvider.SetRenderMode(_renderMode);
            
            NavigationManager.Refresh(true);
        }

    }

    IComponentRenderMode? _renderMode;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (!firstRender)
        {
            await base.OnAfterRenderAsync(firstRender);
            return;
        }

        _renderMode =await FlagProvider.GetRenderMode();
        StateHasChanged();

        await base.OnAfterRenderAsync(firstRender);
        return;
    }

}
