@page "/"
@inject IFlagProvider FlagProvider
@inject NavigationManager NavigationManager

<PageTitle>BlazorWith3d Demo</PageTitle>

<h1>BlazorWith3d Demo</h1>

<p>
    Welcome to your BlazorWith3d demo.
</p>

<p>
    This demo showcases <NavLink  href="https://github.com/mgrman/BlazorWith3d"> BlazorWith3d Repository</NavLink>, ie using source generators to improve JS and Unity interop with Blazor.
</p>

<p>
    With the intent of adding 3D rendering capability to Blazor, which can then be developed using native technology (Typescript or Unity) and source generator handles interop.
</p>

<p>
    Mainly by generating TypeScript types (for ThreeJS and BabylonJS renderers), and setting up automatic implementation of interface methods to be routed through a binary interface (e.g. JS Interop to get data to Javascript world and then back to Unity).
</p>

<p>
    So that developers do not have to add each method to the specific way interop is being handled, but only define interfaces and all boilerplate code is generated by the Source Generator.
</p>

<p>
    See the  <NavLink  href="/app"> App tab</NavLink> for the demo itself.
</p>



@if (FlagProvider.IsWindowsBuildLinkEnabled)
{
    <p>
        Or download the <NavLink href="/windowsApp.zip">Windows App build</NavLink> of this demo to test the windows desktop app (using Blazor MAUI hybrid)
    </p>
}

@if (FlagProvider.SupportedRenderModes.Length > 1)
{
    <br/>
    @if (!RendererInfo.IsInteractive)
    {
        <text> Loading ...</text>
    }
    else
    {
        <p>For testing purposes, you can select the Razor Components Rendering mode:</p>
        <InputSelect @bind-Value="_renderModeName" class="form-select">
            @foreach (var renderMode in FlagProvider.SupportedRenderModes)
            {
                <option value="@renderMode.GetType().Name">@(renderMode.GetType().Name)</option>
            }
        </InputSelect>
    }
}


@code {
    string? _renderModeName
    {
        get
        {
            return  _renderMode?.GetType().Name ?? "";
        }

        set
        {
            _renderMode = FlagProvider.SupportedRenderModes.FirstOrDefault(o => o.GetType().Name == value);
            FlagProvider.SetRenderMode(_renderMode);
            
            NavigationManager.Refresh(true);
        }

    }

    IComponentRenderMode? _renderMode;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (!firstRender)
        {
            await base.OnAfterRenderAsync(firstRender);
            return;
        }

        _renderMode =await FlagProvider.GetRenderMode();
        StateHasChanged();

        await base.OnAfterRenderAsync(firstRender);
        return;
    }

}
